---
title: "软路由与家庭网络配置"
date: 2021-04-10T23:20:35+08:00
draft: true
---

平时喜欢在家折腾一些东西，对很多服务，软路由是一个基础设施。 软路由的概念与硬路由相对，硬路由指由专有硬件来进行网络包转发的设备，而软路由就是由通用计算机通过软件进行网络包转发的设备。 与同样价格的硬路由相比，软路由有更好的硬件以及更高的可配置性，不过需要一定的网络知识才能发挥作用。 下面简单聊聊软路由的部署和功能。

# 设备与系统

软路由和普通计算机比有几个主要特征： 网口多，功耗低，体积小。 软路由设备至少要有两个网口，一个 WAN 口用于连接公网，一个 LAN 口连接局域网 ( 不过旁路由设备只要一个网口就够了 ) 。 由于需要 24 小时不间断运行，通常功耗低且稳定，体积小一些方便放在弱电箱。

系统方面，通常都是 Linux 内核基础上增加定制的软件源和相关软件构成的，比较知名的有 OpenWRT 和梅林，如果是在硬路由上刷系统需要看硬件是否支持。 我由于之前买的路由器内存太少，又买了 NanoPi R2S 作为软路由，自带定制系统 FriendlyWRT，之前的无线路由就只当作无线接入点使用了。

# 网络拓扑

<center><embed src="topo.svg" type="image/svg+xml" /></center>

上面是我家目前的网络拓扑结构，联通宽带光纤接入光猫，调制后网线连软路由 WAN 口，后面 LAN 口串联两个路由，路由器自带 Mesh 功能，关闭 DHCP 当作纯粹的无线 AP 使用。

# 功能

上面介绍了设备和网络拓扑，下面聊聊软件部署以及各种功能的实现。

## 网络拨号

联通宽带安装时的光猫自带拨号以及无线功能，不过光猫拨号的话就没办法使用 DDNS 内网穿透了 ( 一开始因为有公网 IP 想要 DDNS 才折腾半天软路由拨号，几个月之后公网 IP 没了，淦 ) ，所以这里光猫只用作调制解调，软路由负责拨号。 关于软路由拨号的好处可以参考 [这里](https://v2ex.com/t/681901#r_9123965) 。

想用软路由拨号主要需要做两件事：

1.  将光猫改为桥接模式
2.  获取宽带用户名密码

第一项因设备型号而异，需要很多奇技淫巧，关于中国联通的光猫可以参考这两篇文章：

-   [将联通光猫修改为桥接模式 ( 北京地区 )](https://blog.51cto.com/hatech/2521226)
-   [记一次修改联通光猫为桥接模式的经历](https://bygeek.cn/2019/08/18/Change-Optical-modem-to-bridge-mode/)

第二项需要在装宽带的时候记好，或是打中国联通电话重置密码。

之后在软路由界面 网络 -> 接口 处配置 WAN 口的拨号就可以了。

## 全局 VPN

PassWall 是个不错的插件，支持 socks、ss、ssr、v2ray、brook 和

## 主机加速器

## 动态路由与内网穿透

## 内网静态 IP、DNS 劫持 ( 公私网使用同一域名 )
